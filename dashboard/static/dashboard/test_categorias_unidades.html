<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Categorías y Unidades</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Test de Categorías y Unidades</h1>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        Formulario de Prueba
                    </div>
                    <div class="card-body">
                        <form id="testForm">
                            <div class="mb-3">
                                <label for="categoria" class="form-label">Categoría:</label>
                                <div class="input-group">
                                    <select class="form-select" id="categoria" name="categoria">
                                        <option value="">Seleccionar categoría</option>
                                    </select>
                                    <button class="btn btn-outline-primary" type="button" onclick="abrirModalCategoria()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="unidad_medida" class="form-label">Unidad de medida:</label>
                                <div class="input-group">
                                    <select class="form-select" id="unidad_medida" name="unidad_medida">
                                        <option value="">Seleccionar unidad</option>
                                    </select>
                                    <button class="btn btn-outline-primary" type="button" onclick="abrirModalUnidad()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-primary" onclick="cargarDatosFormulario()">
                                Recargar Datos
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        Consola de Depuración
                    </div>
                    <div class="card-body">
                        <div id="console" style="background-color: #f8f9fa; padding: 10px; border-radius: 5px; height: 300px; overflow-y: auto; font-family: monospace;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Categoría -->
    <div class="modal fade" id="nuevaCategoriaModal" tabindex="-1" aria-labelledby="nuevaCategoriaModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="nuevaCategoriaModalLabel">Nueva Categoría</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="nuevaCategoriaForm">
                        <div class="mb-3">
                            <label for="nombre_categoria" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" id="nombre_categoria" name="nombre" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="crearCategoria()">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Unidad -->
    <div class="modal fade" id="nuevaUnidadModal" tabindex="-1" aria-labelledby="nuevaUnidadModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="nuevaUnidadModalLabel">Nueva Unidad de Medida</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="nuevaUnidadForm">
                        <div class="mb-3">
                            <label for="nombre_unidad" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" id="nombre_unidad" name="nombre" required>
                        </div>
                        <div class="mb-3">
                            <label for="abreviacion" class="form-label">Abreviación:</label>
                            <input type="text" class="form-control" id="abreviacion" name="abreviacion" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="crearUnidadMedida()">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Funciones adicionales para la página de prueba
    function log(message) {
        const console = document.getElementById('console');
        const logEntry = document.createElement('div');
        logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        console.appendChild(logEntry);
        console.scrollTop = console.scrollHeight;
    }
    
    function crearCategoria() {
        log('Función crearCategoria() llamada');
    }
    
    function crearUnidadMedida() {
        log('Función crearUnidadMedida() llamada');
    }
    
    // Sobreescribir funciones para testing
    window.abrirModalCategoria = function() {
        log('Abriendo modal de categoría');
        const modal = new bootstrap.Modal(document.getElementById('nuevaCategoriaModal'));
        modal.show();
    };
    
    window.abrirModalUnidad = function() {
        log('Abriendo modal de unidad');
        const modal = new bootstrap.Modal(document.getElementById('nuevaUnidadModal'));
        modal.show();
    };
    
    window.cargarDatosFormulario = function() {
        log('Simulando carga de datos del formulario...');
        
        // Datos de ejemplo
        const data = {
            categorias: [
                {id: 1, nombre: 'Carnes'},
                {id: 2, nombre: 'Pescados'},
                {id: 3, nombre: 'Verduras'},
                {id: 4, nombre: 'Lácteos'}
            ],
            unidades: [
                {id: 1, nombre: 'Kilogramo', abreviacion: 'kg'},
                {id: 2, nombre: 'Gramo', abreviacion: 'g'},
                {id: 3, nombre: 'Litro', abreviacion: 'L'},
                {id: 4, nombre: 'Unidad', abreviacion: 'und'}
            ]
        };
        
        // Cargar categorías
        const categoriaSelect = document.getElementById('categoria');
        if (categoriaSelect) {
            categoriaSelect.innerHTML = '<option value="">Seleccionar categoría</option>';
            data.categorias.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria.id;
                option.textContent = categoria.nombre;
                categoriaSelect.appendChild(option);
            });
            log(`Categorías cargadas: ${data.categorias.length}`);
        } else {
            log("Error: No se encontró el select de categoría");
        }
        
        // Cargar unidades de medida
        const unidadSelect = document.getElementById('unidad_medida');
        if (unidadSelect) {
            unidadSelect.innerHTML = '<option value="">Seleccionar unidad</option>';
            data.unidades.forEach(unidad => {
                const option = document.createElement('option');
                option.value = unidad.id;
                option.textContent = `${unidad.nombre} (${unidad.abreviacion})`;
                unidadSelect.appendChild(option);
            });
            log(`Unidades cargadas: ${data.unidades.length}`);
        } else {
            log("Error: No se encontró el select de unidad");
        }
    };
    
    document.addEventListener('DOMContentLoaded', function() {
        log('Página cargada correctamente');
        log('Cargando datos de prueba automáticamente...');
        setTimeout(() => window.cargarDatosFormulario(), 500);
    });
    </script>
</body>
</html>
